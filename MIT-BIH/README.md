

![v2-24390a7879936f0501588a0c5fcf250f_b](md_images/v2-24390a7879936f0501588a0c5fcf250f_b.webp)

# 房颤（AF）检测算法文档（传统方法）

## 1️⃣ 背景知识

- **ECG 信号**：反映心脏电活动，一段完整心跳波形包含 **P-QRS-T 波**：
  - **P 波**：心房去极化
  - **QRS 波群**：心室去极化，R 波是其中最高峰
  - **T 波**：心室复极化
- **为什么 R 波重要**：
  - 房颤（AF）会导致心室收缩不规律 → RR 间期不规则
  - 精确定位 R 波可以计算 RR 间期，为 AF 检测提供基础

### R 波检测核心策略（Pan-Tompkins 算法）

1. **搜索回溯（Missed R-peak detection）**
   - 如果 1.66 × 上一个 RR 间期内没有检测到新 R 波，算法认为可能漏检
   - 在该时间段内寻找最大峰值作为漏检的 R 波
   - **目的**：防止真实 R 波被噪声或滤波漏检
2. **消除多重检测（Refractory period）**
   - 心脏每次收缩后 ~200ms 不可能再次收缩
   - 200ms 内的峰值被忽略，避免重复检测
3. **T 波判别（T wave discrimination）**
   - 如果峰值出现在前一个 R 波后 <360ms
   - 通过平均斜率判断是否为 T 波：
     - 斜率 < 前一个 R 波一半 → T 波 → 舍弃
     - 斜率 ≥ 前一个 R 波一半 → QRS → 保留

**总结**：

| 步骤         | 原因                 | 直观理解                                 |
| ------------ | -------------------- | ---------------------------------------- |
| 搜索回溯     | 防止漏检 R 波        | 长时间未检测 → 找可能被漏掉的峰值        |
| 消除多重检测 | 避免重复检测         | 心脏 200ms 内不可能跳两下                |
| T 波判别     | 避免误判 T 波为 R 波 | 看斜率与时间间隔，判断峰是 R 波还是 T 波 |

------

## 2️⃣ 数据预处理

### 2.1 滤波去噪

- **目的**：去除基线漂移（低频）、工频干扰（50/60Hz）

- **方法**：

  - 高通滤波：截止 0.5Hz → 去基线漂移
  - 陷波滤波：50Hz, Q=30 → 去工频干扰

- **代码示例**：

  ```
  data_filter = ECG_Filter(ecg_signal, fs=400)
  ```

### 2.2 标准化

- Z-score 标准化，保证幅值一致，便于阈值处理：

  ```
  data = (data_filter - np.mean(data_filter)) / np.std(data_filter)
  ```

------

## 3️⃣ QRS 波检测流程

1. **带通滤波**（5-45Hz）

   - 保留 QRS 波主要频段，滤掉 P、T 波干扰

2. **差分操作**

   - 提取信号变化率，提高 R 波尖锐性：

     ```
     diff = np.r_[0,0,sig[2:]-sig[:-2]]
     ```

3. **阈值判定**

   - 经验阈值结合信号统计：

     ```
     threshold = max(DDpos * 1.2, np.percentile(np.abs(sig), 75) * 0.4)
     ```

   - 保证 R 波峰被检测，噪声忽略

4. **峰值检测**

   ```
   peaks, _ = find_peaks(diff, height=threshold, distance=0.2*fs)
   ```

   - `distance=0.2*fs` 约束最小 RR 间隔

**设计理由**：差分 + 百分位阈值，鲁棒且轻量化

------

## 4️⃣ RR 间期特征计算

### 4.1 RR 间期

```
rr = np.diff(r) / FS
```

- `r`：R 波索引
- `FS`：采样率
- `rr`：相邻 R 波时间间隔（秒）

### 4.2 特征统计

- **CV（变异系数）**：

  ```
  cv = np.std(rr) / np.mean(rr)
  ```

  - 衡量心率变异性，AF 时增大

- **ARI（相邻 RR 差分比）**：

  ```
  ari = np.sum(np.abs(np.diff(rr))) / np.sum(rr)
  ```

  - 衡量 RR 间不规则性，AF 时增大

### 4.3 阈值判定

```
flag = (cv > CV_TH) and (ari > ARI_TH)
```

- 经验阈值：`CV_TH=0.07`, `ARI_TH=0.30`
- 来自 MIT-BIH AF 数据集统计

------

## 🔑 总结

- 核心思路：**准确检测 R 波 → 计算 RR 间期 → 用 CV/ARI 判断心律是否不规则**
- 特点：轻量化、可解释性强、适合嵌入式/实时系统
- 注意事项：
  1. 信号滤波和标准化对结果至关重要
  2. 阈值可根据数据集调整
  3. R 波定位需兼顾漏检、重复检测和 T 波干扰